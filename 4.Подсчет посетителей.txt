Выбрать	
	Посетитель,
	ЕстьNULL(ПериодС,&Дата1) ПериодС,
	ЕстьNULL(ПериодПо,&Дата2) ПериодПо
Поместить Данные
Из(
	Выбрать
		Посетитель,
		ПериодС,
		Максимум(ПериодПо) ПериодПо
	Из(	
		Выбрать
			Вошел.Посетитель,
			Вошел.Время ПериодС,
			Вышел.Время ПериодПо
		ИЗ( Выбрать Посетитель,Время Из РегистрСведений.Нагрузка ГДЕ Направление=1 )Вошел
		Левое Соединение	
		( Выбрать Посетитель,Время Из РегистрСведений.Нагрузка ГДЕ Направление=0 )Вышел
		По Вошел.Посетитель=Вышел.Посетитель И Вошел.Время<Вышел.Время
	)ЗП
	Сгруппировать По Посетитель, ПериодС
)Зп 
ГДЕ ЕстьNULL(ПериодС,&Дата1)<=&Дата2 И ЕстьNULL(ПериодПо,&Дата2)>=&Дата1
;


//ищем пересечения
Выбрать Количество(Различные Д1.Посетитель)
Из Данные Д1
Внутреннее Соединение Данные Д2
По Д1.Посетитель<>Д2.Посетитель 
	И Д1.ПериодС<=Д2.ПериодПо 
	И Д1.ПериодПо>=Д2.ПериодС
	
	